<% include ../partials/header.ejs %>
<div class="container">
  <div class="row">
    <div class="col-md-3 bg-light">
      <p class="lead">Uncantare</p>
      <ul class="list-group">
        <li class="list-group-item active">Morbi leo risus</li>
        <li class="list-group-item">Porta ac consectetur ac</li>
        <li class="list-group-item">Vestibulum at eros</li>
      </ul>
    </div>
    <div class="col-md-9 ">
      <div class="card">
        <div class="card-body">
          <img class="card-img img-fluid mb-3" src="<%= dish.image %>" />
          <div class="px-4">
            <div class="float-none"></div>
            <div class="float-left  font-weight-bold h4">
              <a href="#">
                <%= (dish.name).substring(0, allowedDishNameLength) %></a>
            </div>
            <div class="float-right text-muted font-weight-bold h4">
              <%= dish.price %> z≈Ç
            </div>
            <br />
            <p class="float-none"></p>

            <div class="text-muted">
              <p>
                <small>
                  <b><%= dish.foodplace.name %></b> <%= dish.foodplace.address %>,
                  <%= dish.foodplace.city %>
                </small>
              </p>
            </div>

            <div class="card-text mb-2">
              <%= dish.description %>
            </div>
            <div class="card-text mb-3">
              <em>Submitted by <%= dish.author.username %>,
                <%= moment(dish.createdAt).format("DD MMM YYYY") %>
              </em>
            </div>
            <% if (currentUser && dish.author.id.equals(currentUser.id)) { %>
            <a class="btn btn-sm btn-warning mr-3" href="/dishes/<%= dish.id %>/edit">
              Edit
            </a>
            <form class="d-inline mr-3" action="/dishes/<%= dish.id %>?_method=delete" method="post">
              <button class="btn btn-sm btn-danger">Delete</button>
            </form>
            <% } %>
          </div>
        </div>
      </div>
      <div class="card bg-light">
        <div class="card-body  pt-3 px-5">
          <div class="mb-5">
            <a href="/dishes/<%= dish.id %>/comments/new" class="btn btn-success float-right my-1">Leave a review</a>
          </div>
          <% let comments = dish.comments;
           for(let i = comments.length - 1; i >= 0; i--){
             let comment = comments[i]; %>
          <div class="row pt-2">
            <div class="col-md-12">
              <strong><%= comment.author.username %></strong>
              <span class="float-right text-muted">
                <%= moment(comment.createdAt).fromNow() %>
              </span>
              <p><%= comment.text %></p>
            </div>

            <% if (currentUser && comment.author.id.equals(currentUser.id)) { %>
            <a class="btn btn-sm btn-warning " href="/dishes/<%= dish.id %>/comments/<%= comment.id%>/edit">
              Edit
            </a>
            <form class="d-inline ml-1" action="/dishes/<%= dish.id %>/comments/<%= comment.id%>?_method=delete"
              method="post">
              <button class="btn btn-sm btn-danger">Delete</button>
            </form>
            <% } %>
          </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <% include ../partials/footer.ejs %>
</div>